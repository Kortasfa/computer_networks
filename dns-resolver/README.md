# Итеративный DNS-резолвер

Консольное приложение на C++ для итеративного разрешения доменных имен в IP-адреса, начиная с корневых серверов DNS.

## Описание

Этот DNS-резолвер реализует итеративный алгоритм разрешения DNS-запросов согласно RFC 1035. Программа последовательно опрашивает DNS-серверы начиная с корневых, не используя рекурсивные запросы.

## Особенности

- ✅ Итеративное разрешение DNS (без рекурсии)
- ✅ Поддержка UDP и автоматическое переключение на TCP при усеченных пакетах
- ✅ Поддержка типов записей: A, AAAA, NS, CNAME
- ✅ Режим отладки с подробным логированием
- ✅ Безопасный код с использованием RAII
- ✅ Обработка ошибок и таймаутов
- ✅ Защита от переполнения буферов

## Сборка

```bash
make
```

Или вручную:
```bash
g++ -Wall -Wextra -std=c++17 -O2 -o dns_resolver dns_resolver.cpp
```

## Использование

```bash
./dns_resolver [-d] <domain> <type>
```

### Параметры

- `-d` - включить режим отладки (опционально)
- `domain` - доменное имя для разрешения
- `type` - тип DNS-записи (A, AAAA, NS, CNAME)

### Примеры

```bash
# Разрешение IPv4 адреса
./dns_resolver example.com A

# Разрешение IPv6 адреса
./dns_resolver google.com AAAA

# Разрешение с отладкой
./dns_resolver -d github.com A

# Получение NS записей
./dns_resolver example.com NS
```

## Алгоритм работы

### Итеративное разрешение

1. **Начало с корневых серверов**: Программа начинает запрос с одного из 13 корневых DNS-серверов.

2. **Последовательный опрос**: Для каждого уровня домена (TLD, авторитативные серверы) программа:
   - Отправляет DNS-запрос через UDP
   - Парсит ответ и извлекает записи из секций Answer, Authority, Additional
   - Если ответ усечен (TC флаг установлен), автоматически переключается на TCP

3. **Обработка ответов**:
   - Если найдены записи нужного типа в секции Answer - возвращаем результат
   - Если найден CNAME - рекурсивно разрешаем целевое имя
   - Если найдены NS записи в Authority - используем их для следующей итерации
   - IP-адреса NS серверов ищем в Additional секции

4. **Защита от циклов**: Максимум 20 итераций для предотвращения бесконечных циклов

### Переключение на TCP

При получении усеченного UDP-пакета (флаг TC установлен):

1. Устанавливается TCP-соединение с тем же DNS-сервером
2. Запрос отправляется с префиксом длины (2 байта) согласно RFC 1035
3. Ответ читается с учетом длины из префикса

### Структура DNS-пакета

Программа корректно обрабатывает:
- **Заголовок** (12 байт): ID, флаги, счетчики секций
- **Question секция**: QNAME (с поддержкой компрессии), QTYPE, QCLASS
- **Answer/Authority/Additional секции**: Resource Records с различными типами данных

### Компрессия имен

Реализована поддержка DNS-компрессии (RFC 1035):
- Обработка указателей (первые 2 бита = 11)
- Защита от циклических ссылок (максимум 10 переходов)

## Безопасность

- **RAII**: Автоматическое управление ресурсами сокетов через деструкторы
- **Валидация входных данных**: Проверка доменных имен на корректность
- **Защита от переполнения**: Проверка границ при парсинге пакетов
- **Таймауты**: Ограничение времени ожидания ответов (5 секунд)
- **Обработка ошибок**: Проверка всех системных вызовов

## Структура кода

- `dns_resolver.hpp` - заголовочный файл с определениями классов и структур
- `dns_resolver.cpp` - реализация всех функций
  - `UDPSocket` / `TCPSocket` - RAII обертки для сокетов
  - `DNSResolver` - основной класс резолвера
  - Функции парсинга DNS-пакетов
  - Итеративная логика разрешения

## Ограничения

- Поддерживаются только IPv4 адреса DNS-серверов (корневые серверы имеют IPv4)
- Максимальный размер UDP-пакета: 512 байт (стандарт DNS)
- TCP-пакеты ограничены 65535 байтами

## Тестирование

Примеры тестовых запросов:

```bash
# Простой A запрос
./dns_resolver google.com A

# IPv6 запрос
./dns_resolver ipv6.google.com AAAA

# С отладкой для просмотра итераций
./dns_resolver -d www.example.com A

# NS записи
./dns_resolver -d com NS
```

## Соответствие стандартам

- RFC 1035 - Domain Names - Implementation and Specification
- RFC 1034 - Domain Names - Concepts and Facilities

## Лицензия

Учебный проект для курса компьютерных сетей.

---

**Важно**: Запрещено использовать резолвер для проведения атак типа "отказ в обслуживании" (DNS Amplification) или попыток несанкционированного доступа. Соблюдайте этику сетевого программирования.

